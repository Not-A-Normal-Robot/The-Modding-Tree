<canvas width="1280" height="720" id="dyson" style="border: 1px solid black; background-color: black;"></canvas>
<script>
    const cos = Math.cos;
    const sin = Math.sin;
    const canvas = document.querySelector('#dyson');
    const ctx = canvas.getContext('2d');

    function renderStar(x, y, width, height, theta, phi, radius = 2, color = 'white') {
        let px = x - sin(phi) * width;
        let py = y + cos(phi) * height;
        let p_x = cos(theta) * (px - x) - sin(theta) * (py - y) + x;
        let p_y = sin(theta) * (px - x) + cos(theta) * (py - y) + y;

        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.ellipse(p_x, p_y, radius, radius, 0, 0, Math.PI * 2)
        ctx.fill();
    }

    function renderPlanet(x, y, width, height, theta, phi, radius = 5, color = 'd1e0e8', orbit = true) {
        let px = x - sin(phi) * width;
        let py = y + cos(phi) * height;
        let p_x = cos(theta) * (px - x) - sin(theta) * (py - y) + x;
        let p_y = sin(theta) * (px - x) + cos(theta) * (py - y) + y;
        
        if(orbit) {
            ctx.strokeStyle = 'rgba(255,255,255,0.3)';
            ctx.beginPath();
            ctx.ellipse(x, y, width, height, theta, 0, Math.PI * 2)
            ctx.stroke();
        }

        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.ellipse(p_x, p_y, radius, radius, 0, 0, Math.PI * 2)
        ctx.fill();
    }

    function draw(tick) {
        let i = tick / 10000;

        ctx.clearRect(0, 0, 1280, 720);

        for(let j = 0; j < 1000; j++) {
            let x = Math.sin(j) * 10000;
            let rand = (x - Math.floor(x)) * 10;
            renderPlanet(640, 360, 100 * rand, 20 * rand + (rands[j] * 20), 0.2, -i + rand, 1, 'white', false);
            renderPlanet(640, 360, 100 * rand , 20 * rand + (rands[j] * 20), 0.2, Math.PI - i + rand, 1, 'white', false);
            // renderPlanet(640, 360, 10 * rand, 1.5 * rand, -.2, -i - rand, 2, 'rgba(255,255,255,0.9)', false);
        }

        requestAnimationFrame(draw);
        return;

        ctx.shadowBlur = 0;
        for(let q = 0; q < 500; q++) {
            let x = Math.sin(q) * 10000;
            let randx = (x - Math.floor(x)) * 500;
            let y = Math.sin(q) * 12345;
            let randy = (y - Math.floor(y)) * 500;
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.ellipse((i * 200 + randx) % 500, randy, 1, 1, 0, 0, Math.PI * 2);
            ctx.fill();
        }

        // draw the sun
        ctx.fillStyle = '#ebb734';
            ctx.shadowColor = '#fada66';
            ctx.shadowBlur = 25;
            ctx.beginPath();
            ctx.ellipse(250, 250, 20, 20, 0, 0, Math.PI * 2)
            ctx.fill();
            ctx.shadowColor = 'none';
            ctx.shadowBlur = 0;

        // draw the dyson sphere
        ctx.fillStyle = 'rgba(127, 127, 127, 0.4)';
        ctx.beginPath();
        ctx.ellipse(250, 250, 100, 100, 0, 0, Math.PI * 2);
        ctx.fill();
        for(let j = 0; j < Math.PI * 2; j += Math.PI / 8) {
            ctx.strokeStyle = '#d1e0e8';
            ctx.beginPath();
            ctx.ellipse(250, 250, Math.abs(Math.sin(i + j) * 100), 100, 0, 0, Math.PI * 2);
            ctx.stroke();
        }
        for(let j = 0; j < Math.PI * 2; j += Math.PI / 8) {
            ctx.beginPath();
            ctx.ellipse(250, 250 + Math.sin(j) * 100, Math.abs(Math.cos(j) * 100), 1, 0, 0, Math.PI * 2);
            ctx.stroke();
        }

        renderPlanet(250, 250, 120, 25, -.2, i * 1.2 + 0.2, 6, '#69486b');
        renderPlanet(250, 250, 175, 50, 0.1, i, 6, '#594d38');
        renderPlanet(250, 250, 200, 50, 0, i * 2 + Math.PI, 6, '#5135cc');
        renderPlanet(250 + Math.sin(i * 30) * 10, 250 + Math.cos(i * 30) * 5, 200, 50, 0, i * 2 + Math.PI, 2, '#b9b7c4', false);
        renderPlanet(250, 250, 400, 100, 0.5, i * 2 + Math.PI, 10, '#97cccf');

        requestAnimationFrame(draw);
    }
    requestAnimationFrame(draw);
</script>